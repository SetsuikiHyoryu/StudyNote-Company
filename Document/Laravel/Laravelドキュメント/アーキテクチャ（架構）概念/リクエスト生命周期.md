# リクエスト生命周期

<https://laravel.com/docs/8.x/lifecycle>

## 前書き

- 何故アーキテクチャを説明する必要があるかの説明。

---

## 生命周期概要

### 最初に

- Laravelアプリケーションに対するサーバーからのリクエストの全ての入り口は`public/index.php`ファイルである。フレームワークの他の部分をロードするスタート地点である。

- `index.php`はComposerをロードしautoloader定義を生成する。そして`bootstrap/app.php`からLaravelアプリケーションの実例を検索する。

- Laravel最初に取る動作はアプリケーション又はサービス容器の実例を作ることである。

### HTTP又はコンソール（控制臺）の内核

- `index.php`に着信したリクエストはHTTP内核又はコンソール内核に発送される（アプリケーションに入るリクエストのタイプによって決められる）。この二つの内核は全てのリクエストが通過する中心地点である。HTTP内核（`app/Http/Kernel.php`にある）を例にして説明する。

- HTTP内核は`Illuminate\Foundation\Http\Kernel`クラスを拡張した。中にはリクエストが実行される前に起動する配列`bootstrappers`（引導程序）が定義されてある。これらのbootstrappersはエラー処理の設定、ログの設定、アプリケーション環境の検出、リクエストが実際に処理する前に完成されるべき他の任務を実行する。

- HTTP内核は全てのリクエストがアプリケーションに処理される前に通過するべきHTTP middleware（中間件）のリストをも定義する。これらのmiddlewareはHTTP session（不明）の読み取りと書き込みを処理する。そして、もしアプリケーションがメンテナンスモードの場合を決定し、CSRF token（令牌）などを検証する。

- HTTP内核の`handle`（句柄，不明）方法の方法signature（簽名）：
  - `Request`を受け取り、`Response`を戻す。内核をアプリケーション全体を代表するブラックボックスを見なす。内核にHTTPリクエストを送ることでHTTP応答を戻す。

### サービス提供者(不明)

- 内核bootstrappersの一番重要な動作はアプリケーションにサービス提供者をロードすることである。アプリケーションの全てのサービス提供者は`config/app.php`設定ファイルの`providers`配列に設定されている。

- まず、全ての提供者上で`register`方法をコールする。全ての提供者が登録されたら、`boot`方法がコールされる。

- サービス提供者はフレームワークの全ての様々なcomponent（組件）をbootstrapperingすることに対し責任を取る。例えばデータベース、queue（隊列）、検証、routing components。サービス提供者はフレームワークが提供した全ての特性をbootstrap（導く？）、設定するのでLaravel引導過程全体で一番重要な面である。

### 緊急リクエスト

- アプリケーションが引導され、全てのサービス提供者が登録された後、`Request`はdispatching（発送）（調度）されるのにルーターに引き渡される。ルーターはrouteの任意の特定なmiddlewareを起動する様に、リクエストをroute又はコントローラーに発送する。

---

## サービス提供者に注目する

- 実例を作り、サービス提供者を登録し、引導アプリケーションにリクエストを引き渡す。

- アプリケーションのデフォルトサービス提供者は`app/Providers`ディレクトリに格納されている。

- デフォルトの場合、`AppServiceProvider`は空白である。このproviderは使用者のアプリケーションの自身の引導とサービス容器束縛の良い場所である。大型のアプリケーションには幾つかのサービス提供者を作ることがある。各々のサービス提供者により粒状の引導タイプがある。
